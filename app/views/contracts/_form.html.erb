<% form_model =
     if contract.persisted?
       contract
     else
       [@program, contract]
     end %>

<%= form_with(model: form_model, local: true) do |form| %>
  <% if contract.errors.any? %>
    <div class="flash alert">
      <strong><%= pluralize(contract.errors.count, "error") %>:</strong>
      <ul style="margin: 8px 0 0; padding-left: 18px;">
        <% contract.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form.hidden_field :program_id, value: (@program&.id || contract.program_id) %>

  <label>Contract code</label>
  <%= form.text_field :contract_code, placeholder: "AN-2026-01" %>

  <label>Fiscal year</label>
  <%= form.number_field :fiscal_year, min: 2000, max: 2100, step: 1, placeholder: "2026" %>

  <label>Contract start date</label>
  <%= form.date_field :start_date %>

  <label>Contract end date</label>
  <%= form.date_field :end_date %>

  <label>Planned quantity</label>
  <%= form.number_field :planned_quantity, min: 0, step: 1, placeholder: "63" %>

  <label>Sell price per unit</label>
  <%= form.number_field :sell_price_per_unit, step: 0.01, placeholder: "52030.00" %>

  <label>Notes</label>
  <%= form.text_area :notes, rows: 4, placeholder: "Anything finance or the IPT should know..." %>

  <div class="form-actions">
    <%= form.submit(contract.persisted? ? "Save changes" : "Create contract", class: "btn btn-primary") %>

    <% if @program.present? %>
      <%= link_to "Cancel", program_path(@program), class: "btn" %>
    <% else %>
      <%= link_to "Cancel", programs_path, class: "btn" %>
    <% end %>
  </div>
<% end %>
