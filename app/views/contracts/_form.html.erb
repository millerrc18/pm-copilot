<% form_model = contract.persisted? ? contract : [@program, contract] %>

<%= form_with(model: form_model, local: true, class: "space-y-6", html: { autocomplete: "off" }) do |form| %>
  <% if contract.errors.any? %>
    <div class="rounded-2xl border border-accent-red/40 bg-accent-red/10 p-4 text-sm text-light-text">
      <p class="font-semibold"><%= pluralize(contract.errors.count, "error") %> prohibited this contract from being saved:</p>
      <ul class="mt-2 list-disc space-y-1 pl-5 text-light-text/80">
        <% contract.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form.hidden_field :program_id, value: (@program&.id || contract.program_id) %>

  <div>
    <%= form.label :contract_code, "Contract code", class: "text-sm font-semibold" %>
    <%= form.text_field :contract_code, placeholder: "AN-2026-01", class: "mt-2 w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-light-text placeholder:text-light-text/40 focus-ring" %>
  </div>

  <div class="grid gap-4 md:grid-cols-2">
    <div>
      <%= form.label :fiscal_year, "Fiscal year", class: "text-sm font-semibold" %>
      <%= form.number_field :fiscal_year, min: 2000, max: 2100, step: 1, placeholder: "2026", class: "mt-2 w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-light-text placeholder:text-light-text/40 focus-ring" %>
    </div>
    <div>
      <%= form.label :planned_quantity, "Planned quantity", class: "text-sm font-semibold" %>
      <%= form.number_field :planned_quantity, min: 0, step: 1, placeholder: "63", class: "mt-2 w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-light-text placeholder:text-light-text/40 focus-ring" %>
    </div>
  </div>

  <div class="grid gap-4 md:grid-cols-2">
    <div>
      <%= form.label :start_date, "Contract start date", class: "text-sm font-semibold" %>
      <%= form.date_field :start_date, class: "mt-2 w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-light-text focus-ring" %>
    </div>
    <div>
      <%= form.label :end_date, "Contract end date", class: "text-sm font-semibold" %>
      <%= form.date_field :end_date, class: "mt-2 w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-light-text focus-ring" %>
    </div>
  </div>

  <div>
    <%= form.label :sell_price_per_unit, "Sell price per unit", class: "text-sm font-semibold" %>
    <%= form.number_field :sell_price_per_unit, step: 0.01, placeholder: "52030.00", class: "mt-2 w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-light-text placeholder:text-light-text/40 focus-ring" %>
  </div>

  <div>
    <%= form.label :notes, "Notes", class: "text-sm font-semibold" %>
    <%= form.text_area :notes, rows: 4, placeholder: "Anything finance or the IPT should know...", class: "mt-2 w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-light-text placeholder:text-light-text/40 focus-ring" %>
  </div>

  <div class="flex flex-wrap gap-3">
    <%= form.submit(contract.persisted? ? "Save changes" : "Create contract", class: "inline-flex items-center justify-center rounded-full bg-accent-red px-5 py-2.5 text-sm font-semibold text-white transition hover:bg-accent-red/90 focus-ring") %>
    <% if @program.present? %>
      <%= link_to "Cancel", program_path(@program), class: "inline-flex items-center justify-center rounded-full border border-white/10 bg-white/5 px-5 py-2.5 text-sm font-semibold text-light-text/80 hover:bg-white/10 focus-ring" %>
    <% else %>
      <%= link_to "Cancel", programs_path, class: "inline-flex items-center justify-center rounded-full border border-white/10 bg-white/5 px-5 py-2.5 text-sm font-semibold text-light-text/80 hover:bg-white/10 focus-ring" %>
    <% end %>
  </div>
<% end %>
