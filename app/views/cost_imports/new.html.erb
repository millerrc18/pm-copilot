<% content_for :page_title, "Import costs" %>
<% content_for :page_subtitle, "Upload the Costs template (.xlsx) to track labor and material spend." %>

<div class="panel p-6 max-w-xl space-y-6">
  <%= form_with url: cost_imports_path, local: true, multipart: true, class: "space-y-4" do |f| %>
    <div>
      <%= f.label :program_id, "Program (optional)", class: "text-sm font-semibold" %>
      <%= f.select :program_id,
                   options_from_collection_for_select(@programs, :id, :name, params[:program_id]),
                   { include_blank: "All programs" },
                   class: "mt-2 w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-light-text focus-ring" %>
      <p class="mt-2 text-xs text-light-text/50">Leave blank to import costs that span multiple programs.</p>
    </div>

    <div>
      <%= f.label :file, "Excel file", class: "text-sm font-semibold" %>
      <%= f.file_field :file, class: "mt-2 block w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-light-text focus-ring", accept: ".xlsx" %>
      <p class="mt-2 text-xs text-light-text/50">Tip: period_type and period_start_date are required.</p>
      <p class="mt-2 text-xs text-light-text/50">
        Download template:
        <%= link_to "costs.xlsx", "/templates/costs.xlsx", class: "text-accent-red hover:text-accent-red/80" %>
      </p>
      <p class="mt-2 text-xs text-light-text/50">
        Required headers:
        <code class="rounded bg-white/10 px-2 py-1 text-[11px] text-light-text/70"><%= CostImportService::REQUIRED_HEADERS.join(", ") %></code>
      </p>
    </div>

    <div class="flex flex-wrap gap-3">
      <%= f.submit "Import", class: "inline-flex items-center justify-center rounded-full bg-accent-red px-5 py-2.5 text-sm font-semibold text-white transition hover:bg-accent-red/90 focus-ring" %>
      <%= link_to "Cancel", cost_hub_path, class: "inline-flex items-center justify-center rounded-full border border-white/10 bg-white/5 px-5 py-2.5 text-sm font-semibold text-light-text/80 hover:bg-white/10 focus-ring" %>
    </div>
  <% end %>

  <% if @import_result %>
    <div class="rounded-2xl border border-white/10 bg-white/5 p-4 text-sm text-light-text">
      <p class="font-semibold">Import complete</p>
      <p class="mt-1 text-light-text/60">Created <%= @import_result[:created] %> cost entries.</p>
      <%= link_to "View Cost Hub", cost_hub_path, class: "mt-3 inline-flex text-accent-red hover:text-accent-red/80" %>
    </div>
  <% end %>
</div>
