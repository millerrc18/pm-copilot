<h2 class="text-lg font-semibold text-light-text">Milestone imports</h2>
<p class="mt-1 text-sm text-light-text/60">Load delivery milestones using contract codes in the selected program.</p>

<%= form_with url: milestone_imports_path, local: true, multipart: true, class: "mt-6 space-y-4" do |f| %>
  <div class="relative">
    <%= f.label :program_id, "Program", class: "text-sm font-semibold" %>
    <%= f.select :program_id,
                 options_from_collection_for_select(@programs, :id, :name, @selected_program_id),
                 { include_blank: "Select a program" },
                 class: "mt-2 w-full appearance-none rounded-2xl border border-white/20 bg-dark-panel-strong px-4 py-3 text-sm text-light-text shadow-sm focus:border-accent-red/70 focus:outline-none focus:ring-2 focus:ring-accent-red/50 focus:ring-offset-0",
                 required: true %>
    <p class="mt-2 text-xs text-light-text/50">Contracts in this program are valid for the import.</p>
  </div>

  <div>
    <%= f.label :file, "Excel file", class: "text-sm font-semibold" %>
    <%= f.file_field :file, class: "mt-2 block w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-light-text focus-ring", accept: ".xlsx" %>
    <p class="mt-2 text-xs text-light-text/50">Each row must include a contract_code that belongs to the selected program.</p>
    <p class="mt-2 text-xs text-light-text/50">
      Download template:
      <%= link_to "milestones.xlsx", import_template_path("milestones"), class: "text-accent-red hover:text-accent-red/80" %>
    </p>
    <p class="mt-2 text-xs text-light-text/50">
      Required headers:
      <code class="rounded bg-white/10 px-2 py-1 text-[11px] text-light-text/70"><%= MilestoneImportService::REQUIRED_HEADERS.join(", ") %></code>
    </p>
    <p class="mt-2 text-xs text-light-text/50">Imports are all or nothing. Fix errors and retry.</p>
  </div>

  <div class="flex flex-wrap gap-3">
    <%= f.submit "Import milestones", class: "inline-flex items-center justify-center rounded-full bg-accent-red px-5 py-2.5 text-sm font-semibold text-white transition hover:bg-accent-red/90 focus-ring" %>
    <%= link_to "View milestones", delivery_milestones_path, class: "inline-flex items-center justify-center rounded-full border border-white/10 bg-white/5 px-5 py-2.5 text-sm font-semibold text-light-text/80 hover:bg-white/10 focus-ring" %>
  </div>
<% end %>

<% if @milestone_import_errors.present? %>
  <div class="mt-6 rounded-2xl border border-red-500/30 bg-red-500/10 p-4 text-sm text-red-100">
    <p class="font-semibold">Import failed</p>
    <ul class="mt-2 list-disc space-y-1 pl-5">
      <% @milestone_import_errors.each do |error| %>
        <li><%= error %></li>
      <% end %>
    </ul>
  </div>
<% elsif @milestone_import_result %>
  <div class="mt-6 rounded-2xl border border-emerald-500/30 bg-emerald-500/10 p-4 text-sm text-emerald-100">
    <p class="font-semibold">Import complete</p>
    <p class="mt-1 text-emerald-100/80">
      Created <%= @milestone_import_result[:created] %>, updated <%= @milestone_import_result[:updated] %> milestones.
    </p>
  </div>
<% end %>
