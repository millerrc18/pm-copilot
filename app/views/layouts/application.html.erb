<% theme = "dark" %>
<!DOCTYPE html>
<html class="h-full" data-theme="<%= theme %>">
  <head>
    <title>PM Copilot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0A0D13">

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="min-h-screen bg-dark-bg text-light-text">
    <div class="flex min-h-screen" data-controller="sidebar right-panel">
      <% if user_signed_in? %>
        <%= render "shared/sidebar" %>
        <div class="fixed inset-0 z-30 bg-black/60 opacity-0 pointer-events-none transition md:hidden" data-sidebar-target="backdrop" data-action="click->sidebar#close"></div>
      <% end %>

      <div class="flex-1 flex flex-col min-w-0">
        <% if user_signed_in? %>
          <%= render "shared/topbar" %>
        <% end %>

        <main class="flex-1 overflow-y-auto px-5 py-6 pb-28 md:px-8 md:pb-10">
          <%= render "shared/flash" %>
          <%= yield %>
        </main>
      </div>

      <% if user_signed_in? && content_for?(:right_panel) %>
        <%= render "shared/right_panel" %>
        <div class="fixed inset-0 z-40 bg-black/60 opacity-0 pointer-events-none transition md:hidden" data-right-panel-target="backdrop" data-action="click->right-panel#close"></div>
      <% end %>

      <% if user_signed_in? %>
        <nav class="fixed bottom-0 left-0 right-0 z-30 border-t border-white/10 bg-dark-panel-strong px-6 pt-3 pb-[calc(env(safe-area-inset-bottom)+0.75rem)] backdrop-blur md:hidden" aria-label="Bottom navigation">
          <div class="flex items-center justify-around text-xs">
            <%= link_to programs_path, class: "flex flex-col items-center gap-1 text-light-text/70 hover:text-light-text focus-ring" do %>
              <svg class="icon-sm" viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5a2 2 0 012-2h4l2 2h8a2 2 0 012 2V17a2 2 0 01-2 2H5a2 2 0 01-2-2V7.5z" />
              </svg>
              Programs
            <% end %>
            <%= link_to cost_hub_path, class: "flex flex-col items-center gap-1 text-light-text/70 hover:text-light-text focus-ring" do %>
              <svg class="icon-sm" viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v18" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 7.5a4.5 4.5 0 01-4.5 4.5 4.5 4.5 0 004.5 4.5" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 7.5A4.5 4.5 0 0112 3" />
              </svg>
              Cost Hub
            <% end %>
            <%= link_to docs_path, class: "flex flex-col items-center gap-1 text-light-text/70 hover:text-light-text focus-ring" do %>
              <svg class="icon-sm" viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M7 4h6l4 4v12a2 2 0 01-2 2H7a2 2 0 01-2-2V6a2 2 0 012-2z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M13 4v5h5" />
              </svg>
              Knowledge
            <% end %>
          </div>
        </nav>
      <% end %>
    </div>
  </body>
</html>
