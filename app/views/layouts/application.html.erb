<% theme = current_user&.theme.presence || (user_signed_in? ? "dark" : "light") %>
<% palette = current_user&.palette.presence || "blue" %>
<!DOCTYPE html>
<html data-theme="<%= theme %>" data-palette="<%= palette %>">
  <head>
    <title>PM Copilot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0B0D11">

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="<%= user_signed_in? ? "app-shell-body" : "" %>">
    <% if user_signed_in? %>
      <div class="app-shell" data-controller="sidebar">
        <%= render "shared/sidebar" %>
        <div class="sidebar-backdrop" data-sidebar-target="backdrop" data-action="click->sidebar#close"></div>

        <div class="main-shell">
          <%= render "shared/topbar" %>

          <div class="shell-content">
            <%= render "shared/flash" %>
            <%= yield %>
          </div>
        </div>

        <% if content_for?(:right_panel) %>
          <%= render "shared/right_panel" %>
        <% end %>
      </div>
    <% else %>
      <header class="topbar">
        <div class="container topbar-inner">
          <%= link_to(new_user_session_path, class: "brand") do %>
            <span class="brand-badge" aria-hidden="true"></span>
            <span>PM Copilot</span>
          <% end %>

          <div class="topbar-actions">
            <%= link_to "Sign in", new_user_session_path, class: "btn btn-sm btn-primary" %>
            <%= link_to "Sign up", new_user_registration_path, class: "btn btn-sm" %>
          </div>
        </div>
      </header>

      <main class="container main">
        <%= render "shared/flash" %>
        <%= yield %>
      </main>
    <% end %>
  </body>
</html>
