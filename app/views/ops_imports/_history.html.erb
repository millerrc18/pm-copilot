<div class="panel p-6">
  <div class="flex items-center justify-between gap-4">
    <div>
      <h3 class="text-base font-semibold">Import history</h3>
      <p class="mt-1 text-sm text-light-text/60">Track what was imported and when.</p>
      <p class="mt-2 text-xs text-light-text/50">
        Last updated:
        <%= last_updated_at ? last_updated_at.strftime("%Y-%m-%d %H:%M") : "Not yet updated" %>
      </p>
    </div>
    <% if program.present? %>
      <button
        type="button"
        data-action="frame-refresh#refresh"
        class="inline-flex items-center justify-center rounded-full border border-white/10 bg-white/5 px-4 py-2 text-xs font-semibold text-light-text/70 transition hover:text-light-text focus-ring"
      >
        Refresh status
      </button>
    <% end %>
  </div>

  <% if program.nil? %>
    <p class="mt-4 text-sm text-light-text/60">Select a program to view import history.</p>
  <% elsif imports.empty? %>
    <p class="mt-4 text-sm text-light-text/60">No imports yet for this program.</p>
  <% else %>
    <div class="mt-4 overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="text-left text-xs uppercase tracking-[0.2em] text-light-text/40">
          <tr>
            <th class="pb-3">Imported</th>
            <th class="pb-3">Report</th>
            <th class="pb-3">Rows imported</th>
            <th class="pb-3">Rows rejected</th>
            <th class="pb-3">Status</th>
            <th class="pb-3">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-white/5">
          <% imports.each do |import| %>
            <tr>
              <td class="py-3"><%= import.imported_at&.strftime("%Y-%m-%d %H:%M") || "Pending" %></td>
              <td class="py-3"><%= import.report_type.titleize %></td>
              <td class="py-3"><%= import.rows_imported %></td>
              <td class="py-3"><%= import.rows_rejected %></td>
              <td class="py-3"><%= import.status.titleize %></td>
              <td class="py-3">
                <% if current_user.admin? %>
                  <%= button_to "Delete", ops_import_path(import), method: :delete,
                                form: { data: { turbo_confirm: "Delete this import and its rows?", turbo_stream: true } },
                                class: "text-sm font-semibold text-light-text/70 hover:text-light-text" %>
                <% else %>
                  <span class="text-light-text/40">Admin only</span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
</div>
