<% content_for :page_title, "Import period data" %>
<% content_for :page_subtitle, "Upload an .xlsx workbook with periods, milestones, and unit actuals." %>

<div class="panel p-6 space-y-6 max-w-2xl">
  <div>
    <p class="text-sm text-light-text/60">
      Download template:
      <%= link_to "contract_workbook.xlsx", "/templates/contract_workbook.xlsx", class: "text-accent-red hover:text-accent-red/80" %>
    </p>
    <ul class="mt-4 space-y-3 text-sm text-light-text/60">
      <li>
        <span class="text-xs uppercase tracking-[0.2em] text-light-text/40"><%= ContractWorkbookImporter::SHEET_PERIODS %></span>
        <div class="mt-1 text-xs">Required headers:</div>
        <code class="mt-1 inline-block rounded bg-white/10 px-2 py-1 text-[11px] text-light-text/70"><%= ContractWorkbookImporter::REQUIRED_PERIOD_HEADERS.join(", ") %></code>
      </li>
      <li>
        <span class="text-xs uppercase tracking-[0.2em] text-light-text/40"><%= ContractWorkbookImporter::SHEET_MILESTONES %></span>
        <div class="mt-1 text-xs">Required headers:</div>
        <code class="mt-1 inline-block rounded bg-white/10 px-2 py-1 text-[11px] text-light-text/70"><%= ContractWorkbookImporter::REQUIRED_MILESTONE_HEADERS.join(", ") %></code>
      </li>
      <li>
        <span class="text-xs uppercase tracking-[0.2em] text-light-text/40"><%= ContractWorkbookImporter::SHEET_UNITS %></span>
        <div class="mt-1 text-xs">Required headers:</div>
        <code class="mt-1 inline-block rounded bg-white/10 px-2 py-1 text-[11px] text-light-text/70"><%= ContractWorkbookImporter::REQUIRED_UNIT_HEADERS.join(", ") %></code>
      </li>
    </ul>
  </div>

  <%= form_with url: contract_period_imports_path(@contract), scope: :period_import, local: true, class: "space-y-4" do |f| %>
    <div>
      <%= f.label :file, "Excel file", class: "text-sm font-semibold" %>
      <%= f.file_field :file, accept: ".xlsx", class: "mt-2 block w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-light-text focus-ring" %>
    </div>

    <div class="flex flex-wrap gap-3">
      <%= f.submit "Import", class: "inline-flex items-center justify-center rounded-full bg-accent-red px-5 py-2.5 text-sm font-semibold text-white transition hover:bg-accent-red/90 focus-ring" %>
      <%= link_to "Cancel", contract_path(@contract), class: "inline-flex items-center justify-center rounded-full border border-white/10 bg-white/5 px-5 py-2.5 text-sm font-semibold text-light-text/80 hover:bg-white/10 focus-ring" %>
    </div>
  <% end %>

  <% if defined?(@errors) && @errors.present? %>
    <div class="rounded-2xl border border-accent-red/40 bg-accent-red/10 p-4 text-sm text-light-text">
      <p class="font-semibold">Problems found:</p>
      <ul class="mt-2 list-disc space-y-1 pl-5 text-light-text/80">
        <% @errors.each do |e| %>
          <li><%= e %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
</div>
